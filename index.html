<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Finanças • v19 (Login simples)</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--primary:#10b981}
*{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif}
.center{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
.card{width:min(560px,92vw);background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:18px}
h1{margin:.2rem 0 .8rem 0}
label{font-size:12px;color:var(--muted)}
input,button{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn{cursor:pointer} .btn.primary{background:var(--primary);border-color:var(--primary);color:#02261b;font-weight:600}
.small{font-size:12px;color:var(--muted);margin-top:8px}
.hidden{display:none}
</style>
</head>
<body>
<div class="center" id="gate">
  <div class="card">
    <h1>Finanças • <small>v19</small></h1>
    <div class="row">
      <div><label>E-mail</label><input id="em"></div>
      <div><label>Senha</label><input id="pw" type="password"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="btn primary" id="signin">Entrar</button>
      <button class="btn" id="signup">Criar conta</button>
    </div>
    <div class="small" id="hint"></div>
  </div>
</div>

<div id="app" class="hidden">
  <div class="center"><div class="card">
    <h3>Bem-vindo! (área do app)</h3>
    <div class="small" id="info"></div>
    <button class="btn" id="logout">Sair</button>
  </div></div>
</div>

<script>
// CONFIG: sua URL e chave anon (pode editar se quiser hardcode)
const SB_URL  = 'https://uvygqjwtxyrknkfoozwx.supabase.co';
const SB_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2eWdxand0eHlya25rZm9vend4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNzQwMzMsImV4cCI6MjA3MjY1MDAzM30.QnkZpgrVpfiEJaRcMuBVcJ9iasCPl0GLU99WSVl3q34';

const sp = window.supabase.createClient(SB_URL, SB_ANON);

function show(id, ok){ document.getElementById(id).classList.toggle('hidden', !ok); }
const setHint = (t)=> document.getElementById('hint').textContent = t||'';

async function quickEnter(){
  // chama a RPC para garantir entrada no espaço padrão
  const r = await sp.rpc('quick_enter_default');
  if(r.error){ throw new Error(r.error.message); }
  return r.data; // household_id
}

signin.onclick = async ()=>{
  setHint('');
  const { data, error } = await sp.auth.signInWithPassword({ email: em.value.trim(), password: pw.value });
  if(error){ setHint(error.message); return; }
  try{
    const hhid = await quickEnter();
    document.getElementById('info').textContent = 'Você entrou no espaço padrão. ID: '+hhid;
    show('gate', false); show('app', true);
  }catch(e){
    setHint('Login ok, mas falhou ao entrar: '+e.message);
  }
};

signup.onclick = async ()=>{
  const { error } = await sp.auth.signUp({ email: em.value.trim(), password: pw.value });
  setHint(error? error.message : 'Conta criada! Faça login.');
};

logout.onclick = async ()=>{
  await sp.auth.signOut(); show('app', false); show('gate', true); setHint('');
};
</script>
</body>
</html>
